{{ header }}

  {# start admin panel left sidebar #}
  {{ column_left }}
  {# end admin panel left sidebar #}

  {# start lexus theme control #}
  <div id="content">

    <div class="page-header">
      <div class="container-fluid">
        <h1><b>{{ heading_title }}</b></h1>
        <ul class="breadcrumb">
          {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="container-fluid">

      {% if notices %}
        {% for i, notice in notices %}
          {{ notice }}
        {% endfor %}
      {% endif %}

      <div class="panel panel-default">
        <div class="panel-heading"><h3 class="panel-title"><i class="fa fa-exchange"></i> {{ entry_import_export_text }}</h3></div>
        <div class="panel-body">
          <form class="form-horizontal">
            <fieldset>
              <legend>{{ entry_install_progress_text }}</legend>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_progress_text }}</label>
                <div class="col-sm-10">
                  <div id="progress-import" class="progress">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <div id="progress-text"></div>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                  <a href="#" id="pavothemer-import" class="btn btn-primary"><i class="fa fa-upload"></i> {{ entry_import_text }}</a>
                  <a href="#" id="pavothemer-export" class="btn btn-default" data-start="{{ entry_create_export_path }}" data-loading-text="{{ entry_exporting_text }}"><i class="fa fa-download"></i> {{ entry_export_text }}</a>
                </div>
              </div>
            </fieldset>
          </form>
          <fieldset>
            <legend>{{ entry_export_history_text }}</legend>
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead>
                  <tr>
                    <td style="width: 1px;" class="text-center"><input type="checkbox" onclick="$('input[name*=\'selected\']').prop('checked', this.checked);" /></td>
                    <td class="text-center">
                      {% if sort == 'date_added' %}
                        <a href="{{ sort_date_added }}" class="{{ order|lower }}">{{ entry_created_at_text }}</a>
                      {% else %}
                        <a href="{{ sort_date_added }}">{{ entry_created_at_text }}</a>
                      {% endif %}
                    </td>
                    <td class="text-center">
                      {{ entry_created_by_text }}
                    </td>
                    <td class="text-center">{{ entry_actions_text }}</td>
                  </tr>
                </thead>
                <tbody>
                  {% if samples %}
                    {% for sample in samples %}
                    <tr>
                      <td class="text-center">
                        {% if post.upload_id in selected %}
                          <input type="checkbox" name="selected[]" value="{{ sample.name }}" checked="checked" />
                        {% else %}
                          <input type="checkbox" name="selected[]" value="{{ sample.name }}" />
                        {% endif %}
                      </td>
                      <td class="text-center">{{ sample.date_added }}</td>
                      <td class="text-center">{{ sample.created_by }}</td>
                      <td class="text-center">
                        <a href="{{ sample.download }}" data-toggle="tooltip" title="{{ button_download }}" class="btn btn-info"><i class="fa fa-download"></i> {{ entry_download_text }}</a>
                        <a href="{{ sample.import }}" data-toggle="tooltip" title="{{ button_download }}" class="btn btn-info"><i class="fa fa-upload"></i> {{ entry_import_text }}</a>
                        <a href="{{ sample.delete }}" data-toggle="tooltip" title="{{ button_download }}" class="btn btn-info"><i class="fa fa-upload"></i> {{ entry_delete_text }}</a>
                      </td>
                    </tr>
                    {% endfor %}
                  {% else %}
                    <tr>
                      <td class="text-center" colspan="6">{{ text_no_results }}</td>
                    </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </fieldset>
        </div>
      </div>

    </div>
  </div>
  {# end lexus theme control #}

  {# scripts #}
  <script type="text/javascript">
    (function($){
      var step = 0;
      $( document ).on( 'click', '#pavothemer-export', function(e){
        e.preventDefault();

        var _that = $( this );
        if ( step ) step = 0;
        // make export ajax request
        $.ajax({
          type: 'POST',
          url: '{{ export_ajax_url }}' + '&user_token={{ token }}',
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          beforeSend: function(){
            _that.button( 'loading' );
            $('#progress-text').html( '' );
            $('#progress-bar').removeClass('progress-bar-danger');

            $('#progress-bar').addClass('progress-bar-success');
            $('#progress-text').html('<span class="text-success">' + _that.data( 'start' ) + '</span>');
          }
        }).always(function(){
          _that.button( 'reset' );
        }).done(function( res ){
          if ( typeof res.status === 'undefined' ) return;

          // messages
          if ( res.status === false ) {
            $('#progress-bar').addClass('progress-bar-danger');
            $('#progress-text').html('<div class="text-danger">' + res.text + '</div>');
          } else {
            $('#progress-bar').addClass('progress-bar-success');
            $('#progress-text').html('<span class="text-success">' + res.text + '</span>');
          }

          if ( res.status === true && typeof res.next !== 'undefined' ) {
            next_request( res.next, typeof res.data !== 'undefined' ? res.data : {}, step );
          }
        }).fail(function( xhr, ajaxOptions, thrownError ){
          alert( thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText );
        });

        return false;
      } );

      // make next ajax request
      function next_request( url, data, step ) {

        data.step = step;
        $.ajax({
          type: 'POST',
          url: url,
          dataType: 'json',
          data: data
        }).always(function(){

        }).done(function( res ){

          // messages
          if ( res.status === false ) {
            $('#progress-bar').addClass('progress-bar-danger');
            $('#progress-text').html('<div class="text-danger">' + res.text + '</div>');
          } else {
            $('#progress-bar').addClass('progress-bar-success');
            $('#progress-text').html('<span class="text-success">' + res.text + '</span>');
          }

          if ( res.status === true && typeof res.next !== 'undefined' ) {
            next_request( res.next, typeof res.data !== 'undefined' ? res.data : {}, step );
          }
        }).fail( function( xhr, ajaxOptions, thrownError ){
          alert( thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText );
        });;

      }

    })(jQuery);
  </script>

{{ footer }}
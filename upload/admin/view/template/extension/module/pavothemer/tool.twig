{{ header }}

  {# start admin panel left sidebar #}
  {{ column_left }}
  {# end admin panel left sidebar #}

  {# start lexus theme control #}
  <div id="content">

    <div class="page-header">
      <div class="container-fluid">
        <h1><b>{{ heading_title }}</b></h1>
        <ul class="breadcrumb">
          {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="container-fluid">

      {% if notices %}
        {% for i, notice in notices %}
          {{ notice }}
        {% endfor %}
      {% endif %}

      <div class="panel panel-default">
        <div class="panel-heading"><h3 class="panel-title"><i class="fa fa-exchange"></i> {{ entry_import_export_text }}</h3></div>
        <div class="panel-body">
          <form class="form-horizontal">
            <fieldset>
              <legend>{{ entry_install_progress_text }}</legend>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_progress_text }}</label>
                <div class="col-sm-10">
                  <div id="progress-import" class="progress">
                    <div id="progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <div id="progress-text"></div>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                  <a href="#" id="pavothemer-import" class="btn btn-primary"><i class="fa fa-upload"></i> {{ entry_import_text }}</a>
                  <a href="#" id="pavothemer-export" class="btn btn-default" data-start="{{ entry_create_export_path }}" data-loading-text="{{ entry_exporting_text }}"><i class="fa fa-download"></i> {{ entry_export_text }}</a>
                </div>
              </div>
            </fieldset>
          </form>
          <fieldset>
            <legend>{{ entry_export_history_text }}</legend>
            <div class="table-responsive">
              {{ sample_histories_table }}
            </div>
          </fieldset>
        </div>
      </div>

    </div>
  </div>
  {# end lexus theme control #}

  {# scripts #}
  <script type="text/javascript">
    (function($){
      var step = 1;
      $( document ).on( 'click', '#pavothemer-export', function(e){
        e.preventDefault();
        var step = 1;
        var _that = $( this );
        // make export ajax request
        $.ajax({
          type: 'POST',
          url: '{{ export_ajax_url }}',
          dataType: 'json',
          cache: false,
          contentType: false,
          processData: false,
          beforeSend: function(){
            _that.button( 'loading' );
            $('#progress-text').html( '' );
            $('#progress-bar').removeClass('progress-bar-danger');
            $('#progress-bar').css( 'width', 0 );

            $('#progress-bar').addClass('progress-bar-success');
            $('#progress-text').html('<span class="text-success">' + _that.data( 'start' ) + '</span>');
          }
        }).always(function(){
          _that.button( 'reset' );
        }).done(function( res ){
          if ( typeof res.status === 'undefined' ) return;

          // messages
          if ( typeof res.text !== 'undefined' ) {
            if ( res.status === false ) {
              $('#progress-bar').addClass('progress-bar-danger');
              $('#progress-text').html('<div class="text-danger">' + res.text + '</div>');
            } else {
              $('#progress-bar').addClass('progress-bar-success');
              $('#progress-text').html('<span class="text-success">' + res.text + '</span>');
            }
          }

          if ( res.status === true && typeof res.next !== 'undefined' ) {
            $('#progress-bar').css( 'width', ( step / res.data.steps ) * 100 + '%' );
            next_request( res.next, typeof res.data !== 'undefined' ? res.data : {}, _that, step );
          }
        }).fail(function( xhr, ajaxOptions, thrownError ){
          $('#progress-text').html('<div class="text-danger">' + thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText + '</div>');
        });

        return false;
      } );

      // make next ajax request
      function next_request( url, data, button, step ) {
        $.ajax({
          type: 'POST',
          url: url,
          dataType: 'json',
          data: {
            data: data
          },
          beforeSend: function() {
            button.button( 'loading' );
          }
        }).always(function(){
          button.button( 'reset' );
        }).done(function( res ){

          // messages
          if ( typeof res.text !== 'undefined' ) {
            if ( res.status === false ) {
              $('#progress-bar').addClass('progress-bar-danger');
              $('#progress-text').html('<div class="text-danger">' + res.text + '</div>');
            } else {
              step++;
              $('#progress-bar').css( 'width', ( parseInt( step ) / data.steps ) * 100 + '%' );
              $('#progress-bar').addClass('progress-bar-success');
              $('#progress-text').html('<span class="text-success">' + res.text + '</span>');
            }
          }

          if ( res.status === true && typeof res.next !== 'undefined' ) {
            next_request( res.next, typeof res.data !== 'undefined' ? res.data : {}, button, step );
          }

          if ( typeof res.table !== 'undefined' ) {
            $( '#sample-histories-table' ).replaceWith( res.table );
          }

        }).fail( function( xhr, ajaxOptions, thrownError ){
          $('#progress-bar').addClass('progress-bar-danger');
          $('#progress-text').html('<div class="text-danger">' + thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText + '</div>');
        });

      }

      // delete export
      $( document ).on( 'click', '.pavothemer-delete-export', function(e){
        e.preventDefault();
        var _that = $( this );
        var sample = _that.data( 'sample' );
        var theme = _that.data( 'theme' );

        $.ajax({
          url: '{{ delete_export_url }}',
          data: {
            sample: sample,
            theme: theme
          },
          beforeSend: function() {
            _that.button( 'loading' );
            $('#progress-bar').removeClass('progress-bar-danger progress-bar-success');
            $('#progress-bar').css( 'width', 0 );
          }
        }).always(function(){
          _that.button( 'reset' );
        }).done(function( res ){
          if ( typeof res.text !== 'undefined' ) {
            if ( res.status === false ) {
              $('#progress-bar').addClass('progress-bar-danger');
              $('#progress-text').html('<div class="text-danger">' + res.text + '</div>');
            } else {
              $('#progress-bar').addClass('progress-bar-success');
              $('#progress-text').html('<span class="text-success">' + res.text + '</span>');
            }
          }
          if ( typeof res.table !== 'undefined' ) {
            $( '#sample-histories-table' ).replaceWith( res.table );
          }
        }).fail(function( xhr, ajaxOptions, thrownError ){
          $('#progress-bar').addClass('progress-bar-danger');
          $('#progress-text').html('<div class="text-danger">' + thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText + '</div>');
        });
        return false;
      } );

    })(jQuery);
  </script>

{{ footer }}